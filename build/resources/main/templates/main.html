<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì¸ í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #007bff;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        .header h1 {
            font-size: 24px;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        .nav-button {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.3s;
        }
        .nav-button:hover {
            background-color: rgba(255,255,255,0.3);
        }
        .main-content {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        .menu-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .menu-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 300px;
            min-height: 200px;
        }
        .menu-card h2 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .submenu {
            margin-bottom: 15px;
        }
        .submenu h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .submenu-item {
            margin-left: 20px;
            margin-bottom: 5px;
        }
        .submenu-item a {
            color: #666;
            text-decoration: none;
            padding: 5px 10px;
            display: block;
            border-radius: 4px;
            transition: background-color 0.3s;
            cursor: pointer;
        }
        .submenu-item a:hover {
            background-color: #f8f9fa;
            color: #007bff;
        }
        .submenu-item a:active {
            background-color: #007bff;
            color: white;
            transform: scale(0.98);
        }
        .clickable-menu {
            position: relative;
        }
        .clickable-menu:before {
            content: "ğŸ”—";
            position: absolute;
            right: 5px;
            font-size: 10px;
            color: #007bff;
        }
        .page-title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .refresh-section {
            text-align: center;
            margin-bottom: 20px;
        }
        .refresh-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .refresh-button:hover {
            background-color: #218838;
        }
        .refresh-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .quick-access-card {
            display: block;
            text-decoration: none;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .quick-access-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            color: white;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>ì‚¬ìš©ì ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <div class="nav-buttons">
                <button onclick="navigateWithToken('/main')" class="nav-button">ğŸ  í™ˆ</button>
                <a href="/swagger-ui/index.html" class="nav-button" target="_blank">ğŸ“š SWAGGER</a>
                <button onclick="logout()" class="nav-button">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <h2 class="page-title">ë©”ì¸ ë©”ë‰´</h2>
        
        <div class="refresh-section">
            <button id="refreshMenuBtn" class="refresh-button">ğŸ”„ ë©”ë‰´ ìƒˆë¡œê³ ì¹¨</button>
            <button id="debugMenuBtn" class="refresh-button" style="background-color: #6c757d; margin-left: 10px;">ğŸ” ë©”ë‰´ ë””ë²„ê¹…</button>
            <button id="debugTokenBtn" class="refresh-button" style="background-color: #dc3545; margin-left: 10px;">ğŸ” í† í° ë””ë²„ê¹…</button>
            <button id="debugUsersBtn" class="refresh-button" style="background-color: #28a745; margin-left: 10px;">ğŸ‘¥ ì‚¬ìš©ì ëª©ë¡</button>
            <button id="createTestUserBtn" class="refresh-button" style="background-color: #17a2b8; margin-left: 10px;">â• í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±</button>
            <div id="message" class="message"></div>
            <div id="debugResult" class="message" style="text-align: left; white-space: pre-line; font-family: monospace; font-size: 12px;"></div>
        </div>
        
        <!-- ê´€ë¦¬ ê¸°ëŠ¥ ë¹ ë¥¸ ì•¡ì„¸ìŠ¤ -->
        <div style="background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); padding: 20px; margin-bottom: 30px;">
            <h3 style="text-align: center; margin-bottom: 20px; color: #333;">ğŸš€ ê´€ë¦¬ ê¸°ëŠ¥ ë¹ ë¥¸ ì•¡ì„¸ìŠ¤</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div onclick="navigateWithToken('/code/list')" class="quick-access-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“‹</div>
                    <div style="font-weight: bold;">ì½”ë“œ ê´€ë¦¬</div>
                    <div style="font-size: 12px; opacity: 0.9;">ì‹œìŠ¤í…œ ì½”ë“œ ë“±ë¡/ìˆ˜ì •</div>
                </div>
                <div onclick="navigateWithToken('/file/upload')" class="quick-access-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“</div>
                    <div style="font-weight: bold;">íŒŒì¼ ê´€ë¦¬</div>
                    <div style="font-size: 12px; opacity: 0.9;">íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ</div>
                </div>
                <div onclick="navigateWithToken('/log/system')" class="quick-access-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ“Š</div>
                    <div style="font-weight: bold;">ë¡œê·¸ ê´€ë¦¬</div>
                    <div style="font-size: 12px; opacity: 0.9;">ì‹œìŠ¤í…œ ë¡œê·¸ ì¡°íšŒ</div>
                </div>
                <div onclick="navigateWithToken('/user/list')" class="quick-access-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ‘¥</div>
                    <div style="font-weight: bold;">ì‚¬ìš©ì ê´€ë¦¬</div>
                    <div style="font-size: 12px; opacity: 0.9;">ì‚¬ìš©ì ë“±ë¡/ì¡°íšŒ</div>
                </div>
                <div onclick="navigateWithToken('/token/list')" class="quick-access-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); cursor: pointer;">
                    <div style="font-size: 24px; margin-bottom: 8px;">ğŸ”</div>
                    <div style="font-weight: bold;">í† í° ê´€ë¦¬</div>
                    <div style="font-size: 12px; opacity: 0.9;">í† í° ì¡°íšŒ/ê´€ë¦¬</div>
                </div>
            </div>
        </div>
        
        <div class="menu-container">
            <div th:each="menu : ${menus}" class="menu-card">
                <h2 th:text="${menu.name}"></h2>
                
                <div th:each="submenu : ${menu.children}" class="submenu">
                    <h3 th:text="${submenu.name}"></h3>
                    <div th:each="subitem : ${submenu.children}" class="submenu-item">
                        <a th:href="${subitem.menuUrl}" th:text="${subitem.name}" class="clickable-menu" onclick="handleMenuClick(event, this)"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // JWT ì¸í„°ì…‰í„°ê°€ ì´ë¯¸ getStoredTokenì„ ì œê³µí•˜ë¯€ë¡œ ì¤‘ë³µ ì •ì˜ ë°©ì§€
        
        // í† í° ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function getStoredToken() {
            return localStorage.getItem('authToken');
        }
        
        function setAuthHeader(token) {
            // ëª¨ë“  AJAX ìš”ì²­ì— í† í° í—¤ë” ìë™ ì¶”ê°€
            const originalFetch = window.fetch;
            window.fetch = function(url, options = {}) {
                options.headers = options.headers || {};
                if (token) {
                    options.headers['Authorization'] = 'Bearer ' + token;
                }
                return originalFetch(url, options);
            };
        }
        
        // JWT í† í°ê³¼ í•¨ê»˜ í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
        function navigateWithToken(url) {
            const token = getStoredToken();
            if (!token) {
                console.warn('í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = '/auth/login';
                return;
            }
            
            // Authorization í—¤ë”ì™€ í•¨ê»˜ í˜ì´ì§€ ìš”ì²­
            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else if (response.status === 401 || response.status === 403) {
                    throw new Error('ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                } else {
                    throw new Error('í˜ì´ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + response.status);
                }
            })
            .then(html => {
                // í˜ì´ì§€ HTMLì„ ë°›ì•˜ìœ¼ë©´ ì „ì²´ë¥¼ êµì²´
                document.open();
                document.write(html);
                document.close();
                
                // URLì„ ë³€ê²½ (ë’¤ë¡œê°€ê¸° ì§€ì›)
                window.history.pushState({}, '', url);
            })
            .catch(error => {
                console.error('í˜ì´ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                if (error.message.includes('ì¸ì¦ì´ ë§Œë£Œ')) {
                    alert(error.message);
                    localStorage.removeItem('authToken');
                    window.location.href = '/auth/login';
                } else {
                    alert('í˜ì´ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });
        }
        
        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        function logout() {
            const token = getStoredToken();
            if (token) {
                // ì„œë²„ì— ë¡œê·¸ì•„ì›ƒ ìš”ì²­
                fetch('/auth/logout', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                })
                .then(() => {
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í° ì œê±°
                    localStorage.removeItem('authToken');
                    console.log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
                })
                .catch(error => {
                    console.error('ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨:', error);
                    // ì‹¤íŒ¨í•´ë„ ë¡œì»¬ í† í°ì€ ì œê±°
                    localStorage.removeItem('authToken');
                })
                .finally(() => {
                    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = '/auth/login';
                });
            } else {
                window.location.href = '/auth/login';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° ì„¤ì •
        window.addEventListener('DOMContentLoaded', function() {
            const token = getStoredToken();
            if (token) {
                setAuthHeader(token);
                console.log('í† í°ì´ HTTP í—¤ë”ì— ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                // í† í° ìƒíƒœ í‘œì‹œ
                const tokenStatus = document.createElement('div');
                tokenStatus.id = 'tokenStatus';
                tokenStatus.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background-color: #28a745;
                    color: white;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    z-index: 1000;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                `;
                tokenStatus.textContent = 'ğŸ” í† í° í™œì„±í™”';
                document.body.appendChild(tokenStatus);
                
                // 5ì´ˆ í›„ í† í° ìƒíƒœ í‘œì‹œ ìˆ¨ê¸°ê¸°
                setTimeout(() => {
                    tokenStatus.style.display = 'none';
                }, 5000);
            } else {
                console.warn('ì €ì¥ëœ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                
                // í† í° ì—†ìŒ ìƒíƒœ í‘œì‹œ
                const noTokenStatus = document.createElement('div');
                noTokenStatus.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    background-color: #dc3545;
                    color: white;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    z-index: 1000;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                `;
                noTokenStatus.textContent = 'âš ï¸ í† í° ì—†ìŒ';
                document.body.appendChild(noTokenStatus);
                
                // 5ì´ˆ í›„ ìƒíƒœ í‘œì‹œ ìˆ¨ê¸°ê¸°
                setTimeout(() => {
                    noTokenStatus.style.display = 'none';
                }, 5000);
            }
        });
        
        // ë©”ë‰´ í´ë¦­ ì²˜ë¦¬ í•¨ìˆ˜ (JWT í† í° í¬í•¨)
        function handleMenuClick(event, element) {
            event.preventDefault(); // ê¸°ë³¸ ë§í¬ ë™ì‘ ë°©ì§€
            
            const url = element.href;
            if (!url || url === '#') {
                return;
            }
            
            // í´ë¦­ëœ ë©”ë‰´ì— ë¡œë”© ìƒíƒœ í‘œì‹œ
            const originalText = element.textContent;
            element.textContent = 'ë¡œë”© ì¤‘...';
            element.style.backgroundColor = '#007bff';
            element.style.color = 'white';
            element.style.pointerEvents = 'none';
            
            // JWT í† í°ê³¼ í•¨ê»˜ í˜ì´ì§€ ì´ë™
            const token = getStoredToken();
            if (!token) {
                console.warn('í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = '/auth/login';
                return;
            }
            
            // Authorization í—¤ë”ì™€ í•¨ê»˜ í˜ì´ì§€ ìš”ì²­
            fetch(url, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else if (response.status === 401 || response.status === 403) {
                    throw new Error('ì¸ì¦ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                } else {
                    throw new Error('í˜ì´ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + response.status);
                }
            })
            .then(html => {
                // í˜ì´ì§€ HTMLì„ ë°›ì•˜ìœ¼ë©´ ì „ì²´ë¥¼ êµì²´
                document.open();
                document.write(html);
                document.close();
                
                // URLì„ ë³€ê²½ (ë’¤ë¡œê°€ê¸° ì§€ì›)
                window.history.pushState({}, '', url);
            })
            .catch(error => {
                console.error('í˜ì´ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
                
                // ë¡œë”© ìƒíƒœ ë³µì›
                element.textContent = originalText;
                element.style.backgroundColor = '';
                element.style.color = '';
                element.style.pointerEvents = '';
                
                if (error.message.includes('ì¸ì¦ì´ ë§Œë£Œ')) {
                    alert(error.message);
                    localStorage.removeItem('authToken');
                    window.location.href = '/auth/login';
                } else {
                    alert('í˜ì´ì§€ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            });
        }

        document.getElementById('refreshMenuBtn').addEventListener('click', function() {
            const button = this;
            const message = document.getElementById('message');
            const debugResult = document.getElementById('debugResult');
            
            button.disabled = true;
            button.textContent = 'ìƒˆë¡œê³ ì¹¨ ì¤‘...';
            message.style.display = 'none';
            debugResult.style.display = 'none';
            
            fetch('/api/refresh-menus', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.text())
            .then(data => {
                message.textContent = data;
                message.className = 'message success';
                message.style.display = 'block';
                
                // 2ì´ˆ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
            })
            .catch(error => {
                message.textContent = 'ë©”ë‰´ ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                message.className = 'message error';
                message.style.display = 'block';
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'ğŸ”„ ë©”ë‰´ ìƒˆë¡œê³ ì¹¨';
            });
        });

        document.getElementById('debugMenuBtn').addEventListener('click', function() {
            const button = this;
            const debugResult = document.getElementById('debugResult');
            const message = document.getElementById('message');
            
            button.disabled = true;
            button.textContent = 'ë””ë²„ê¹… ì¤‘...';
            message.style.display = 'none';
            
            fetch('/api/debug-menus', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.text())
            .then(data => {
                debugResult.textContent = data;
                debugResult.className = 'message success';
                debugResult.style.display = 'block';
            })
            .catch(error => {
                debugResult.textContent = 'ë©”ë‰´ ë””ë²„ê¹… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                debugResult.className = 'message error';
                debugResult.style.display = 'block';
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'ğŸ” ë©”ë‰´ ë””ë²„ê¹…';
            });
        });

        // í† í° ë””ë²„ê¹… ê¸°ëŠ¥ ì¶”ê°€
        document.getElementById('debugTokenBtn').addEventListener('click', function() {
            const button = this;
            const debugResult = document.getElementById('debugResult');
            const message = document.getElementById('message');
            
            button.disabled = true;
            button.textContent = 'í† í° ë¶„ì„ ì¤‘...';
            message.style.display = 'none';
            
            const token = getStoredToken();
            let debugInfo = '=== JWT í† í° ë””ë²„ê¹… ì •ë³´ ===\n\n';
            
            if (!token) {
                debugInfo += 'âŒ localStorageì— í† í°ì´ ì—†ìŠµë‹ˆë‹¤.\n';
                debugInfo += 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\n';
                debugResult.textContent = debugInfo;
                debugResult.className = 'message error';
                debugResult.style.display = 'block';
                button.disabled = false;
                button.textContent = 'ğŸ” í† í° ë””ë²„ê¹…';
                return;
            }
            
            debugInfo += 'âœ… localStorageì—ì„œ í† í° ë°œê²¬:\n';
            debugInfo += 'í† í° ê¸¸ì´: ' + token.length + ' ë¬¸ì\n';
            debugInfo += 'í† í° ì‹œì‘: ' + token.substring(0, 50) + '...\n\n';
            
            // í† í° ì„œë²„ ê²€ì¦ ìš”ì²­
            fetch('/api/debug-token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({ token: token })
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    return response.text().then(errorText => {
                        throw new Error('Status ' + response.status + ': ' + errorText);
                    });
                }
            })
            .then(data => {
                debugInfo += 'ì„œë²„ ì‘ë‹µ:\n' + data;
                debugResult.textContent = debugInfo;
                debugResult.className = 'message success';
                debugResult.style.display = 'block';
            })
            .catch(error => {
                debugInfo += 'âŒ ì„œë²„ ê²€ì¦ ì‹¤íŒ¨:\n' + error.message + '\n\n';
                debugInfo += 'ì´ëŠ” í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.\n';
                debugInfo += 'ìƒˆë¡œìš´ ë¡œê·¸ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                debugResult.textContent = debugInfo;
                debugResult.className = 'message error';
                debugResult.style.display = 'block';
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'ğŸ” í† í° ë””ë²„ê¹…';
            });
        });

        // ì‚¬ìš©ì ëª©ë¡ ë””ë²„ê¹… ê¸°ëŠ¥ ì¶”ê°€
        document.getElementById('debugUsersBtn').addEventListener('click', function() {
            const button = this;
            const debugResult = document.getElementById('debugResult');
            const message = document.getElementById('message');
            
            button.disabled = true;
            button.textContent = 'ì‚¬ìš©ì ì¡°íšŒ ì¤‘...';
            message.style.display = 'none';
            
            fetch('/api/debug-users', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    return response.text().then(errorText => {
                        throw new Error('Status ' + response.status + ': ' + errorText);
                    });
                }
            })
            .then(data => {
                debugResult.textContent = data;
                debugResult.className = 'message success';
                debugResult.style.display = 'block';
            })
            .catch(error => {
                debugResult.textContent = 'âŒ ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:\n' + error.message;
                debugResult.className = 'message error';
                debugResult.style.display = 'block';
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'ğŸ‘¥ ì‚¬ìš©ì ëª©ë¡';
            });
        });

        // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ê¸°ëŠ¥ ì¶”ê°€
        document.getElementById('createTestUserBtn').addEventListener('click', function() {
            const button = this;
            const debugResult = document.getElementById('debugResult');
            const message = document.getElementById('message');
            
            button.disabled = true;
            button.textContent = 'ì‚¬ìš©ì ìƒì„± ì¤‘...';
            message.style.display = 'none';
            
            fetch('/api/create-test-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                } else {
                    return response.text().then(errorText => {
                        throw new Error('Status ' + response.status + ': ' + errorText);
                    });
                }
            })
            .then(data => {
                debugResult.textContent = data;
                debugResult.className = 'message success';
                debugResult.style.display = 'block';
            })
            .catch(error => {
                debugResult.textContent = 'âŒ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨:\n' + error.message;
                debugResult.className = 'message error';
                debugResult.style.display = 'block';
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'â• í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±';
            });
        });
    </script>

    <!-- JWT í† í° ì „ì—­ ì¸í„°ì…‰í„° -->
    <script src="/js/jwt-interceptor.js"></script>
</body>
</html> 